<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CartDAO">

  <!-- 담기(중복 시 무시) -->
  <insert id="add" parameterType="CartDTO">
    INSERT IGNORE INTO cart (username, product_num)
    VALUES (#{username}, #{productNum})
  </insert>

  <!-- 빼기 -->
  <delete id="remove" parameterType="CartDTO">
    DELETE FROM cart
     WHERE username = #{username}
       AND product_num = #{productNum}
  </delete>

  <!-- 내 장바구니 목록 (제품 정보 합쳐서 보여주기) -->
  <select id="listByUser" parameterType="string" resultType="map">
    SELECT p.product_num   AS productNum,
           p.product_name  AS productName,
           p.product_rate  AS productRate,
           p.product_sale  AS productSale,
           p.product_category AS productCategory,
           c.created_at    AS addedAt
      FROM cart c
      JOIN products p ON p.product_num = c.product_num
     WHERE c.username = #{username}
     ORDER BY c.created_at DESC
  </select>

  <!-- 담겨있는지 여부 -->
  <select id="exists" parameterType="CartDTO" resultType="int">
    SELECT COUNT(*) FROM cart
     WHERE username = #{username}
       AND product_num = #{productNum}
  </select>

</mapper>
